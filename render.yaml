# render.yaml (Versión Definitiva)
services:
  # 1. BASE DE DATOS (PostgreSQL)
  # Solo necesitamos el tipo, nombre, región y plan. Render maneja el resto.
  - type: pserv
    name: traductordb
    region: oregon
    plan: starter
    
  # 2. BROKER DE CANALES (Redis para WebSockets)
  # Solo necesitamos el tipo, nombre, región y plan.
  - type: redis
    name: redis-broker
    region: oregon
    plan: starter
    # Eliminamos la línea ipAllowList para evitar conflictos de validación.

  # 3. SERVIDOR WEB (Django + WebSockets)
  - type: web
    name: mi-backend-django
    region: oregon
    env: python
    # CRÍTICO: El 'startCommand' y el 'env' resuelven los errores de runtime.
    startCommand: "daphne backend.asgi:application -b 0.0.0.0 -p 10000"
    plan: starter
    buildCommand: "./build.sh" 
    
    envVars:
      - key: DATABASE_URL 
        fromDatabase:
          name: traductordb
          property: connectionString
      - key: REDIS_URL 
        fromService:
          type: redis
          name: redis-broker
          property: connectionString
      - key: DEBUG
        value: "False"
      - key: SECRET_KEY
        generateValue: true
      - key: WEB_CONCURRENCY
        value: 4