# render.yaml (Versión Definitiva y Corregida)
services:
  # 1. BASE DE DATOS (PostgreSQL)
  - type: pserv
    name: traductordb
    region: oregon
    plan: starter
    
  # 2. BROKER DE CANALES (Redis para WebSockets)
  - type: redis
    name: redis-broker
    region: oregon
    plan: starter
    # CRÍTICO: Permitir acceso solo desde la red interna de Render
    ipAllowList:
      - source: private
      
  # 3. SERVIDOR WEB (Django + WebSockets)
  - type: web
    name: mi-backend-django
    region: oregon
    env: python
    startCommand: "daphne backend.asgi:application -b 0.0.0.0 -p 10000"
    plan: starter
    buildCommand: "./build.sh" 
    
    envVars:
      - key: DATABASE_URL 
        fromDatabase:
          name: traductordb
          property: connectionString
      - key: REDIS_URL 
        fromService:
          type: redis
          name: redis-broker
          property: connectionString
      - key: DEBUG
        value: "False"
      - key: SECRET_KEY
        generateValue: true
      - key: WEB_CONCURRENCY
        value: 4